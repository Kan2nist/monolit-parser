# Задача: Создание Unity Клиента для Skazka.mobi на основе захваченных данных

## Контекст
Мы создаем полностью функциональный клиент на Unity для игры [skazka.mobi](https://skazka.mobi).
У нас нет исходного кода сервера или клиента. Вместо этого мы используем набор данных, "захваченный" (спаршенный) с оригинального веб-клиента во время игровой сессии.
Твоя задача — использовать эти данные для реконструкции клиента, который подключается к реальному серверу, воспроизводит логику и визуальную часть игры.

## Входные данные (Captured Data)
Все данные находятся в директории `captured_data`. Вот как их интерпретировать:

1.  **`textures/`**: Изображения (.png, .jpg), загруженные игрой.
    *   Используй их для UI спрайтов, фонов и текстур объектов.
    *   Имена файлов — это MD5 хеши. Используй `assets_map.json`, чтобы понять, какой URL соответствует какому файлу (это может помочь понять назначение текстуры по её оригинальному имени, например `button_bg.png`).

2.  **`scripts/`**: JavaScript файлы оригинального клиента.
    *   **ВАЖНО:** Это твой главный источник истины о логике.
    *   Тебе нужно проанализировать эти скрипты, чтобы понять:
        *   Протокол обмена сообщениями (структура пакетов WebSocket).
        *   Логику шифрования/авторизации (если есть).
        *   Формулы расчета игровой логики (если они есть на клиенте).

3.  **`snapshots/`**: JSON файлы, содержащие "слепки" DOM-дерева страницы в разные моменты времени.
    *   Каждый снапшот содержит структуру HTML элементов и их Computed Styles (позиция, размер, цвет, шрифт).
    *   **Твоя задача:** Написать парсер или вручную использовать эти данные для воссоздания UI в Unity (Canvas).
    *   Структура JSON: `{ "tagName": "DIV", "styles": { "left": "10px", ... }, "children": [...] }`.

4.  **`websocket_log.jsonl`**: Лог WebSocket сообщений.
    *   Формат: JSON Lines. Каждая строка содержит `type` (SENT/RECEIVED), `payload` (само сообщение) и `timestamp`.
    *   Используй это для реверс-инжиниринга протокола. Сопоставь действия в игре (которые ты видишь в снапшотах/текстурах) с сообщениями, отправленными на сервер.

5.  **`http_log.jsonl`**: Лог HTTP запросов.
    *   Используй для понимания процесса начальной загрузки, авторизации (Login) и получения конфигурации перед установкой WebSocket соединения.

## Технические Требования
*   **Движок:** Unity 2022 LTS (или новее).
*   **Язык:** C#.
*   **UI:** Unity UI (uGUI) или UI Toolkit (на твое усмотрение, uGUI предпочтительнее для точного позиционирования из HTML).
*   **Сеть:** Native WebSocket client (например, `ClientWebSocket` или популярные библиотеки вроде `NativeWebSocket`).

## Этапы Реализации

### 1. Анализ Протокола (Reverse Engineering)
*   Изучи `websocket_log.jsonl` и `scripts/`.
*   Определи формат сообщений (JSON, Binary, Protobuf?). Скорее всего JSON.
*   Выдели основные типы сообщений: `Auth`, `Move`, `Attack`, `UpdateState`.
*   Создай C# классы для десериализации этих сообщений.

### 2. Сетевой Слой
*   Реализуй менеджер сети, который:
    *   Выполняет HTTP запросы для логина (анализируй `http_log.jsonl`).
    *   Устанавливает WebSocket соединение.
    *   Поддерживает соединение (Heartbeat/Ping-Pong).
    *   Маршрутизирует входящие сообщения в соответствующие контроллеры игры.

### 3. Реконструкция UI
*   Используй `snapshots/` как чертежи.
*   Напиши инструмент (Editor Script) или создай вручную префабы для основных экранов:
    *   Экран входа (Login).
    *   Главное меню / Лобби.
    *   Игровой интерфейс (HUD).
*   **Текстуры:** Подставь изображения из `textures/` на соответствующие места.

### 4. Игровая Логика
*   Реализуй машину состояний (State Machine) для управления потоком игры (Login -> Lobby -> Game).
*   Синхронизируй состояние локального клиента с данными от сервера (позиции игроков, HP, чат).

## Работа с Неполными Данными (Заглушки)
Так как сессия захвата могла не покрыть 100% игры:
1.  **Отсутствующие ассеты:** Если текстура не найдена, используй яркий "Magenta" квадрат или стандартный UI спрайт Unity.
2.  **Неизвестные экраны:** Если сервер требует перехода на экран, для которого нет снапшота (например, "Магазин"), создай пустой экран с кнопкой "Назад" и текстом "Not Implemented: Shop".
3.  **Неизвестные пакеты:** Если приходит неизвестное сообщение от сервера, логируй его в консоль (`Debug.LogWarning("Unknown packet: " + json)`), но не крашь клиент.

## Результат
Твоя цель — предоставить проект Unity (скрипты и структуру), который можно запустить, ввести реальные учетные данные (или использовать анонимный вход, если игра позволяет) и увидеть, как клиент взаимодействует с живым сервером `skazka.mobi`.
